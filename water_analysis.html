<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="BCCA Water Bill Analysis - 12-month tracking of water and sewer costs with consumption trends and cost breakdown">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <title>Water Bill Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f4f6f9; }
        /* Navbar Styling to match Portal */
        .navbar-custom { background: #2c3e50; }
        .navbar-brand { font-weight: bold; color: white !important; }
        .btn-back { color: #ecf0f1; border: 1px solid rgba(255,255,255,0.3); }
        .btn-back:hover { background: rgba(255,255,255,0.1); color: white; }
        
        .card { box-shadow: 0 2px 10px rgba(0,0,0,0.05); border: none; margin-bottom: 30px; }
        .chart-container { position: relative; height: 700px; width: 100%; }
        .table-highlight-success { border-left: 5px solid #27ae60; }
        .table-highlight-warning { border-left: 5px solid #f1c40f; }
        .table-highlight-danger { border-left: 5px solid #e74c3c; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-custom mb-4">
    <div class="container">
        <a class="navbar-brand" href="index.html">
            <i class="bi bi-house-door-fill me-2"></i>Community Dashboard
        </a>
        <div class="ms-auto">
            <a href="index.html" class="btn btn-sm btn-back">
                <i class="bi bi-arrow-left me-1"></i> Back to Portal
            </a>
        </div>
    </div>
</nav>

<div class="container-fluid px-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="fw-bold text-dark">Water & Sewer Cost Analysis <span class="text-muted fw-light fs-5">| Nov 2024 - Oct 2025</span></h2>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-white py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold text-primary"><i class="bi bi-bar-chart-fill me-2"></i>Cost Composition Trend</h5>
                        <span class="badge bg-light text-dark border">Interactive 12-Month View</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>
                <div class="card-footer bg-light text-muted small">
                    <i class="bi bi-info-circle-fill me-1"></i>
                    <strong>Key Insight:</strong> The "Winter Base" (Dec '24) proves indoor usage is low (~73 CCF). The Summer spike (Aug '25) to 186 CCF is driven by outdoor use, incurring heavy Sewer fees.
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header fw-bold bg-white border-bottom">
                    <i class="bi bi-table me-2"></i>Detailed Billing Data
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0 text-center align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th>Month</th>
                                    <th>Total Bill</th>
                                    <th>Usage (CCF)</th>
                                    <th>Sewer Vol. (Red)</th>
                                    <th>Water Vol. (Blue)</th>
                                    <th>Fixed Costs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Nov 2024</td><td>$1,978.38</td><td>106</td><td>$776.16</td><td>$271.36</td><td>$930.86</td></tr>
                                <tr class="table-success table-highlight-success">
                                    <td>Dec 2024</td><td>$1,602.18</td><td>73</td><td>$514.80</td><td>$186.88</td><td>$900.50</td>
                                </tr>
                                <tr class="table-highlight-warning">
                                    <td>Jan 2025</td><td>$2,020.51</td><td>106</td><td>$793.80</td><td>$276.93</td><td>$949.78</td>
                                </tr>
                                <tr><td>Feb 2025</td><td>$1,835.14</td><td>89</td><td>$660.96</td><td>$234.07</td><td>$940.11</td></tr>
                                <tr><td>Mar 2025</td><td>$2,163.58</td><td>117</td><td>$889.44</td><td>$307.71</td><td>$966.43</td></tr>
                                <tr><td>Apr 2025</td><td>$1,717.84</td><td>79</td><td>$579.36</td><td>$207.77</td><td>$930.71</td></tr>
                                <tr><td>May 2025</td><td>$1,964.17</td><td>100</td><td>$750.72</td><td>$263.00</td><td>$950.45</td></tr>
                                <tr><td>Jun 2025</td><td>$1,975.90</td><td>101</td><td>$758.88</td><td>$265.63</td><td>$951.39</td></tr>
                                <tr><td>Jul 2025</td><td>$2,515.48</td><td>147</td><td>$1,134.24</td><td>$386.61</td><td>$994.63</td></tr>
                                <tr class="table-danger table-highlight-danger">
                                    <td>Aug 2025</td><td>$2,972.95</td><td>186</td><td>$1,452.48</td><td>$489.18</td><td>$1,031.29</td>
                                </tr>
                                <tr><td>Sep 2025</td><td>$2,316.07</td><td>130</td><td>$995.52</td><td>$341.90</td><td>$978.65</td></tr>
                                <tr><td>Oct 2025</td><td>$2,163.58</td><td>117</td><td>$889.44</td><td>$307.71</td><td>$966.43</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Chart Configuration
    const ctx = document.getElementById('mainChart').getContext('2d');
    
    const labels = ['Nov 24', 'Dec 24', 'Jan 25', 'Feb 25', 'Mar 25', 'Apr 25', 'May 25', 'Jun 25', 'Jul 25', 'Aug 25', 'Sep 25', 'Oct 25'];
    const consumptionData = [106, 73, 106, 89, 117, 79, 100, 101, 147, 186, 130, 117];
    
    const sewerVol = [776.16, 514.80, 793.80, 660.96, 889.44, 579.36, 750.72, 758.88, 1134.24, 1452.48, 995.52, 889.44];
    const waterVol = [271.36, 186.88, 276.93, 234.07, 307.71, 207.77, 263.00, 265.63, 386.61, 489.18, 341.90, 307.71];
    const fixedCosts = [930.86, 900.50, 949.78, 940.11, 966.43, 930.71, 950.45, 951.39, 994.63, 1031.29, 978.65, 966.43];

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Consumption (CCF)',
                    data: consumptionData,
                    type: 'line',
                    borderColor: '#2c3e50',
                    borderWidth: 4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#2c3e50',
                    pointRadius: 6,
                    yAxisID: 'y_consumption',
                    tension: 0.2,
                    order: 0
                },
                {
                    label: 'Sewer Volume Charges ($)',
                    data: sewerVol,
                    backgroundColor: '#e74c3c',
                    stack: 'Stack 0',
                    order: 1
                },
                {
                    label: 'Water Volume Charges ($)',
                    data: waterVol,
                    backgroundColor: '#3498db',
                    stack: 'Stack 0',
                    order: 1
                },
                {
                    label: 'Fixed Fees ($)',
                    data: fixedCosts,
                    backgroundColor: '#95a5a6',
                    stack: 'Stack 0',
                    order: 1
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top', labels: { font: { size: 14 } } },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        footer: (tooltipItems) => {
                            let total = 0;
                            tooltipItems.forEach((item) => {
                                if (item.dataset.type !== 'line') total += item.parsed.y;
                            });
                            return 'Total Cost: $' + total.toFixed(2);
                        }
                    }
                }
            },
            scales: {
                x: { grid: { display: false }, ticks: { font: { size: 14, weight: 'bold' } } },
                y: { stacked: true, position: 'left', title: { display: true, text: 'Cost ($)', font: { size: 16 } } },
                y_consumption: { position: 'right', title: { display: true, text: 'Usage (CCF)', font: { size: 16 } }, grid: { drawOnChartArea: false } }
            }
        }
    });
</script>

</body>
</html>
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

CoHouser is a static HTML/JavaScript web application providing financial and utility analytics dashboards for the Bellingham Co-Housing Association (BCCA). It visualizes budget comparisons (2025 Approved vs 2026 Proposed) and water/sewer utility costs.

## Running the Application

No build step required - this is a static website.

```bash
# Option 1: Open HTML files directly in browser
open index.html

# Option 2: Serve with Python HTTP server
python3 -m http.server 8000
# Visit http://localhost:8000/index.html
```

## Technology Stack

- **Frontend**: HTML5, Vanilla JavaScript, CSS3
- **UI Framework**: Bootstrap 5.3.0
- **Charts**: Plotly.js v2.27.0, Chart.js
- **Data**: JSON objects embedded directly in HTML files
- **CDN**: All libraries loaded from jsDelivr/Plotly CDN (no local dependencies)

## Architecture

Each HTML file is a self-contained single-page dashboard:

| File | Purpose |
|------|---------|
| `index.html` | Landing portal with links to dashboards |
| `budget_analysis.html` | 2025 vs 2026 budget comparison with Sankey diagrams |
| `water_analysis.html` | 12-month water/sewer billing with consumption trends |
| `BCCAFinance.html` | **Live finance dashboard** - loads data from QuickBooks via JSON files |

**Data Flow**:
- Static dashboards: PDF source documents → Manual extraction → JavaScript objects in HTML
- Live dashboard (BCCAFinance.html): QuickBooks API → CLI tool → JSON files → Dashboard

**Key Patterns**:
- Tab-based navigation for multi-period comparisons
- View mode toggle (currency $ vs percentage %)
- Responsive Bootstrap grid layout
- No build tools, no backend, no package installation required

## QuickBooks Integration

The `BCCAFinance.html` dashboard now loads live data from QuickBooks Online.

### Data Files

JSON files in `/data/` are generated by the CLI tool:
- `cash-investments.json` - Balance sheet data (bank accounts, CDs, investments)
- `budget-vs-actual.json` - P&L by committee with drill-down to line items
- `summary.json` - High-level summary for quick loading
- `raw/` - Raw API responses (gitignored, for debugging)

### CLI Tool (`cli/qb_refresh.py`)

```bash
cd cli
source venv/bin/activate

# First time: fetch tokens after OAuth authorization
python qb_refresh.py --fetch-tokens

# Regular data refresh
python qb_refresh.py           # Fetch, transform, commit, and push
python qb_refresh.py --dry-run # Fetch only, don't commit
python qb_refresh.py --no-push # Commit locally, don't push
```

### Azure Function (`azure-function/`)

OAuth callback handler deployed to Azure Functions. Handles the redirect from Intuit OAuth and stores tokens in Azure Blob Storage.

### Configuration

The CLI requires `cli/config.json` (gitignored). Copy from `config.example.json`:
- `client_id` / `client_secret` - From Intuit Developer Portal
- `realm_id` - QuickBooks company ID
- `azure_storage_connection_string` - For fetching tokens after OAuth

## Data Sources

Source PDFs are stored in `/data/` but ignored by git:
- `2026 BCCA Budget First Read.pdf` - Budget source document
- `water_bill/` - Monthly water bills (Nov 2024 - Oct 2025)
- Feature design and implementation plans are located under this folder: /Users/varunr/Library/Mobile Documents/iCloud~md~obsidian/Documents/Varun/Bhavana AI/Cohousing
